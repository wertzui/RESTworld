<p-table [value]="value"
         [lazy]="true"
         [lazyLoadOnInit]="false"
         (onLazyLoad)="load($event)"
         responsiveLayout="scroll"
         [paginator]="true"
         [rows]="rows"
         [rowsPerPageOptions]="rowsPerPage"
         [totalRecords]="totalRecords"
         [loading]="isLoading"
         [showInitialSortBadge]="true"
         [columns]="columns"
         [sortField]="sortField"
         [sortOrder]="sortOrder">

    <ng-template pTemplate="header" let-columns>
        <tr>
            <th *ngFor="let col of columns" [pSortableColumn]="col.name">
                <div class="p-d-flex p-jc-between p-ai-center">
                    {{col.prompt}}
                    <p-sortIcon [field]="col.name"></p-sortIcon>
                    <p-columnFilter [type]="toColumnFilterType(col.type)" [field]="col.name" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex justify-content-end">
                    <div class="mx-2">
                        <a *ngIf="!createButtonMenu" class="p-button-success" icon="fas fa-plus" pButton [routerLink]="[editLink, apiName, rel, newHref]" pTooltip="Create new" tooltipPosition="left"></a>
                        <p-splitButton *ngIf="createButtonMenu" styleClass="p-button-success" icon="fas fa-plus" pTooltip="Create new" tooltipPosition="left" (onClick)="createNew()" [model]="createButtonMenu" appendTo="body"></p-splitButton>
                    </div>
                </div>
            </th>
        </tr>
    </ng-template>

    <ng-template pTemplate="body" let-entity let-columns="columns">
        <tr>
            <td [ngSwitch]="col.type" *ngFor="let col of columns">
                <ng-container *ngSwitchCase="PropertyType.Text">
                    <rw-avatar *ngIf="col.name === 'createdBy' || col.name === 'lastChangedBy'" [user]="entity[col.name]"></rw-avatar>
                    <span *ngIf="col.name !== 'createdBy' && col.name !== 'lastChangedBy'">{{entity[col.name]}}</span>
                </ng-container>
                <span *ngSwitchCase="PropertyType.Number" class="flex justify-content-end">{{entity[col.name]}}</span>
                <span *ngSwitchCase="PropertyType.Bool" class="flex justify-content-center"><p-triStateCheckbox [(ngModel)]="entity[col.name]" [readonly]="true"></p-triStateCheckbox></span>
                <span *ngSwitchCase="PropertyType.Date" [pTooltip]="entity[col.name]">{{entity[col.name] | date:dateFormat}}</span>
                <span *ngSwitchCase="PropertyType.DatetimeLocal" [pTooltip]="entity[col.name]">{{entity[col.name] | date:dateFormat}}</span>
                <span *ngSwitchCase="PropertyType.DatetimeOffset" [pTooltip]="entity[col.name]">{{entity[col.name] | date:dateFormat}}</span>
                <span *ngSwitchCase="PropertyType.Collection" class="flex justify-content-end"><p *ngFor="let arrayElement of entity[col.name]">{{arrayElement | json}}</p></span>
                <span *ngSwitchCase="PropertyType.Object" class="flex justify-content-end">{{entity[col.name] | json}}</span>
            </td>
            <td>
                <div class="flex justify-content-end">
                    <a pButton pTooltip="View/Edit" tooltipPosition="left" [routerLink]="[editLink, apiName, rel, entity._links?.self[0].href]" icon="fas fa-edit"></a>
                    <button pTooltip="Delete" tooltipPosition="left" pButton *ngIf="entity._links.delete" (click)="showDeleteConfirmatioModal(entity)" icon="fas fa-trash-alt" type="button" class="mx-2 p-button-danger"></button>
                </div>
            </td>
        </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="8">No entries found.</td>
        </tr>
    </ng-template>

</p-table>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
